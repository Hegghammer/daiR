<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting up GCS from the command line • daiR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Setting up GCS from the command line">
<meta property="og:description" content="daiR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-NL6TR4PT51"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NL6TR4PT51');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">daiR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/quickstart.html">Quickstart</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/configuration.html">Configuration</a>
    </li>
    <li>
      <a href="../articles/gcs_storage.html">Working with Google Cloud Storage</a>
    </li>
    <li>
      <a href="../articles/usage.html">Basic usage</a>
    </li>
    <li>
      <a href="../articles/tables.html">Extracting tables</a>
    </li>
    <li>
      <a href="../articles/reconstructing_text.html">Correcting text output</a>
    </li>
    <li>
      <a href="../articles/searchable_pdfs.html">Creating searchable PDFs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faqs.html">FAQs</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/hegghammer/dair/" class="external-link">
    <span class="fab fa-github"></span>
     
    Github
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Hegghammer/daiR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setting up GCS from the command line</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Hegghammer/daiR/blob/HEAD/vignettes/articles/gcs_cli.Rmd" class="external-link"><code>vignettes/articles/gcs_cli.Rmd</code></a></small>
      <div class="hidden name"><code>gcs_cli.Rmd</code></div>

    </div>

    
    
<p>Using Google Document AI with <code>daiR</code> (or any other client
library) requires the prior configuration of a Google Cloud Services
account. This article describes how to achieve this using the
command-line tool <a href="https://cloud.google.com/sdk/gcloud/" class="external-link">gcloud
CLI</a>. The procedure is equivalent to the GUI-based one described <a href="https://dair.info/articles/setting_up_google_storage.html" class="external-link">here</a>
and <a href="https://dair.info/articles/using_document_ai.html" class="external-link">here</a>, but
it minimizes interaction with the <a href="https://console.cloud.google.com" class="external-link">Google Cloud Console</a> and
arguably provides more replicability.</p>
<div class="section level3">
<h3 id="prepare-a-google-account">1. Prepare a Google account<a class="anchor" aria-label="anchor" href="#prepare-a-google-account"></a>
</h3>
<p>Your gcloud CLI installation will need to be connected to a Google
account for billing and such. Decide which Google account you want to be
connected with this project or <a href="https://support.google.com/accounts/answer/27441?hl=en" class="external-link">create a
new one</a> if necessary. Have the login details for this account
ready.</p>
</div>
<div class="section level3">
<h3 id="set-up-billing-in-the-google-cloud-console">2. Set up billing in the Google Cloud Console<a class="anchor" aria-label="anchor" href="#set-up-billing-in-the-google-cloud-console"></a>
</h3>
<p>While logged in to your preferred Google account, go to <a href="https://console.cloud.google.com" class="external-link">Google Cloud Console</a> and
click “Try for free” and “Activate”. In step 1, choose your country,
select the term that best describes your organization, and check the box
to accept the terms of service. In step 2, verify your mobile number. In
step 3, enter your payment information (including a credit card or
Paypal information) and click “Start my free trial”. You will be taken
to the two-factor authentication service associated with your credit
card. Back on the Google website, press the blue “Proceed to
verification” button. Here you may be asked to upload a photo of your
credit card and a photo of an id document.</p>
</div>
<div class="section level3">
<h3 id="prepare-id-variables">3. Prepare id variables<a class="anchor" aria-label="anchor" href="#prepare-id-variables"></a>
</h3>
<p>To facilitate the subsequent process, it is useful to create a
project id and a service account id in advance and store them as
environment variables. The ids need to be between 6 and 30 characters
long. The strings need to be unique, so something like
<code>my-ocr</code> will not work, whereas <code>ocr-834963</code>
might.</p>
<p>Open a terminal and type the following, replacing
<code>&lt;a_project_id&gt;</code> and
<code>&lt;a_service_account_id&gt;</code> with your preferred
strings.</p>
<div class="section level4">
<h4 id="linux-and-mac">Linux and Mac<a class="anchor" aria-label="anchor" href="#linux-and-mac"></a>
</h4>
<pre><code><span><span class="va">PROJ_ID</span><span class="op">=</span><span class="st">"&lt;project_id&gt;"</span> <span class="op">&amp;&amp;</span> <span class="va">SA_ID</span><span class="op">=</span><span class="st">"&lt;service_account_id&gt;"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h4>
<pre><code>set PROJ_ID=&lt;project_id&gt;

set SA_ID=&lt;service_account_id&gt;</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="download-and-install-gcloud-cli">4. Download and install gcloud CLI<a class="anchor" aria-label="anchor" href="#download-and-install-gcloud-cli"></a>
</h3>
<p>Follow the <a href="https://cloud.google.com/sdk/docs/install" class="external-link">instructions</a> for
your operating system. Note that on Windows, the installer takes you
straight to initialization (and hence login to Google). On Mac and Linux
you install the CLI first and then launch the initialization with the
command <code>gcloud init</code>.</p>
<p>After you have clicked “Allow” in the browser, return to the
terminal.</p>
<p>On Linux, gcloud will now print something along the lines of “You are
logged in as: [<your_gmail_address>]. This account has no projects.
Would you like to create one? (Y/n)?” Here it is best to decline - type
<code>n</code> then hit Enter.</your_gmail_address></p>
<p>On Windows, it will print something like “You are logged in as:
[<your_gmail_address>]. Pick cloud project to use:”. Choose option 1
here and press Enter.</your_gmail_address></p>
<p>Now type:</p>
<div class="section level4">
<h4 id="linux-and-mac-1">Linux and Mac<a class="anchor" aria-label="anchor" href="#linux-and-mac-1"></a>
</h4>
<p><code>gcloud projects create $PROJ_ID</code></p>
<p>followed by</p>
<p><code>gcloud config set project $PROJ_ID</code></p>
</div>
<div class="section level4">
<h4 id="windows-1">Windows<a class="anchor" aria-label="anchor" href="#windows-1"></a>
</h4>
<p><code>gcloud projects create %PROJ_ID%</code></p>
<p>followed by</p>
<p><code>gcloud config set project %PROJ_ID%</code></p>
</div>
</div>
<div class="section level3">
<h3 id="create-a-service-account">5. Create a service account<a class="anchor" aria-label="anchor" href="#create-a-service-account"></a>
</h3>
<p>Next, create a service account by typing the following in the
terminal:</p>
<div class="section level4">
<h4 id="linux-and-mac-2">Linux and Mac<a class="anchor" aria-label="anchor" href="#linux-and-mac-2"></a>
</h4>
<pre><code>gcloud iam service-accounts create $SA_ID \
--description="RStudio" \
--display-name="RStudio"</code></pre>
</div>
<div class="section level4">
<h4 id="windows-2">Windows<a class="anchor" aria-label="anchor" href="#windows-2"></a>
</h4>
<pre><code>gcloud iam service-accounts create %SA_ID% --description="RStudio" --display-name="RStudio"</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="get-key-file">6. Get key file<a class="anchor" aria-label="anchor" href="#get-key-file"></a>
</h3>
<p>Now get a key file - you will need it to authenticate from within
RStudio:</p>
<div class="section level4">
<h4 id="linux-and-mac-3">Linux and Mac<a class="anchor" aria-label="anchor" href="#linux-and-mac-3"></a>
</h4>
<pre><code>gcloud iam service-accounts keys create key.json \
--iam-account=$SA_ID@$PROJ_ID.iam.gserviceaccount.com</code></pre>
</div>
<div class="section level4">
<h4 id="windows-3">Windows<a class="anchor" aria-label="anchor" href="#windows-3"></a>
</h4>
<pre><code>gcloud iam service-accounts keys create key.json --iam-account=%SA_ID%@%PROJ_ID%.iam.gserviceaccount.com</code></pre>
<p>This will create and download a file titled <code>key.json</code> to
your current location in the file system. Verify with <code>dir</code>
(Windows) or <code>ls</code> (Mac or Linux). Move it to your preferred
location and set the path as an environment variable
<code>GCS_AUTH_FILE</code> in .Renviron (For example:
<code>GCS_AUTH_FILE=/home/user/keys/key.json</code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="confer-permissions">7. Confer permissions<a class="anchor" aria-label="anchor" href="#confer-permissions"></a>
</h3>
<p>First give Google Cloud owner rights to this service account:</p>
<div class="section level4">
<h4 id="linux-mac">Linux &amp; Mac<a class="anchor" aria-label="anchor" href="#linux-mac"></a>
</h4>
<pre><code>gcloud projects add-iam-policy-binding $PROJ_ID \
--member="serviceAccount:$SA_ID@$PROJ_ID.iam.gserviceaccount.com" \
--role="roles/owner"</code></pre>
</div>
<div class="section level4">
<h4 id="windows-4">Windows<a class="anchor" aria-label="anchor" href="#windows-4"></a>
</h4>
<pre><code>gcloud projects add-iam-policy-binding %PROJ_ID% --member="serviceAccount:%SA_ID%@%PROJ_ID%.iam.gserviceaccount.com" --role="roles/owner"</code></pre>
<p>Finally, enable the Document AI API:</p>
<p><code>gcloud services enable documentai.googleapis.com</code></p>
</div>
</div>
<div class="section level3">
<h3 id="section"></h3>
<p>You can now pick up from Step 8 in <a href="https://dair.info/articles/configuration.html" class="external-link">this
vignette</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Hegghammer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
