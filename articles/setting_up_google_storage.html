<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting up a Google Storage bucket • daiR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Setting up a Google Storage bucket">
<meta property="og:description" content="daiR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-NL6TR4PT51"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NL6TR4PT51');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">daiR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/basics.html">Quickstart</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/setting_up_google_storage.html">Setting up a Google Storage bucket</a>
    </li>
    <li>
      <a href="../articles/using_document_ai.html">Using Google Document AI with R</a>
    </li>
    <li>
      <a href="../articles/extracting_tables.html">Extracting tables</a>
    </li>
    <li>
      <a href="../articles/reconstructing_text.html">Correcting text output from Google Document AI</a>
    </li>
    <li>
      <a href="../articles/complex_file_and_folder_management.html">Complex file and folder management</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faqs.html">FAQs</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/hegghammer/dair/" class="external-link">
    <span class="fab fa-github"></span>
     
    Github
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Hegghammer/daiR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setting up a Google Storage bucket</h1>
                        <h4 data-toc-skip class="author">Thomas
Hegghammer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Hegghammer/daiR/blob/HEAD/vignettes/setting_up_google_storage.Rmd" class="external-link"><code>vignettes/setting_up_google_storage.Rmd</code></a></small>
      <div class="hidden name"><code>setting_up_google_storage.Rmd</code></div>

    </div>

    
    
<p><strong>Last updated 4 April 2021</strong><br><strong>Command line users: See <a href="https://dair.info/articles/gcs_cli.html" class="external-link">here</a> for GCS setup
using gcloud CLI.</strong><br><br></p>
<p>This is a rundown for beginners of how to set up and interact with
Google Storage in R. You need Google Storage in order to use Document AI
and other Google APIs on scale, because these services do not accept
bulk file submissions directly. Instead they use Google Storage as an
intermediary, so you need to know how to get files in and out of it.</p>
<p>It is possible to bulk upload and download files to Google Storage in
the <a href="https://console.cloud.google.com/storage" class="external-link">Google Cloud
Console</a>. In fact, for uploads it can sometimes be easier than doing
it programmatically. But downloads and deletions are cumbersome if you
have a lot of files. And since bulk processing in DAI can only be done
with code, you might as well keep the whole workflow in R.</p>
<div class="section level2">
<h2 id="authentication">Authentication<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h2>
<p>The biggest hurdle to using any Google API is authentication, which
is daunting for several reasons. It involves abstract new concepts like
“service accounts”, “Oauth2.0”, and “scopes”. Moreover, the Google Cloud
Console is so crowded it’s a nightmare to navigate as a beginner. In
addition, different R packages have different procedures for
authenticating with Google Cloud Services (GCS).</p>
<p>A full explanation of Google API authentication could fill a book,
but suffice to say here that there are several different ways to
authenticate to GCS from R. In the following I will walk you through one
such way, the one I think is the simplest and most robust if you are
primarily planning to use Google Storage and Google Document AI and to
do so in an interactive setting.</p>
<p>The procedure outlined below relies on service accounts and json key
files. It involves a little bit more hands-on configuration than some of
the setup wizards in other Google API wrappers, but the solution is
robust and secure. My thinking is: if you are computer-literate enough
to consider working programmatically with an API, you are also able to
find your way around the Google Cloud Console. But know that there are
<a href="https://cran.r-project.org/package=gargle/vignettes/get-api-credentials.html" class="external-link">several</a>
<a href="https://cran.r-project.org/package=googleAuthR/vignettes/google-authentication-types.html" class="external-link">other</a>
authentication strategies; which is better depends on where and how you
intend to use the R wrapper.</p>
<div class="section level3">
<h3 id="step-1-get-a-gmail-account">Step 1: Get a Gmail account<a class="anchor" aria-label="anchor" href="#step-1-get-a-gmail-account"></a>
</h3>
<p>If you have one already, you can use that. Or you can <a href="https://accounts.google.com/signup/v2/webcreateaccount" class="external-link">create</a>
a burner account for your GCS work.</p>
</div>
<div class="section level3">
<h3 id="step-2-activate-the-google-cloud-console">Step 2: Activate the Google Cloud Console<a class="anchor" aria-label="anchor" href="#step-2-activate-the-google-cloud-console"></a>
</h3>
<p>While logged in to your gmail account, go to the <a href="https://console.cloud.google.com/" class="external-link">Google Cloud Console</a>. Agree
to the terms of service and click “Try for free”.</p>
<p><img src="storage1.PNG" width="50%"></p>
<p>Accept the terms again, and add an address and a <strong>credit
card</strong>. This last part is a prerequisite for using GCS.</p>
</div>
<div class="section level3">
<h3 id="step-3-link-your-project-to-your-billing-account">Step 3: Link your project to your billing account<a class="anchor" aria-label="anchor" href="#step-3-link-your-project-to-your-billing-account"></a>
</h3>
<p>The largest “unit” of your GCS activities is your <em>project</em>.
You can think of it as your root folder, since you will most likely only
ever need one unless you are a business or a developer (in principle,
though, you can have as many projects as you like).</p>
<p>When you activate GCS, you are assigned a project named “My first
project”. Click on “My first project” in the top blue bar, just to the
right of “Google cloud services”. You’ll see a screen like this:</p>
<p><img src="storage2.PNG" width="50%"></p>
<p>Note that your project has an <em>ID</em>, usually consisting of an
adjective, a noun, and a number. You’ll need this soon, so I recommend
opening RStudio and storing it as a vector with
<code>project_id &lt;- "&lt;your project id&gt;"</code>.</p>
<p>Return to the Google Cloud Console and look at the left column.
Toward the top you see an entry called “Billing”. Click it. You’ll get
to a screen saying “This project has no billing account”. Click “link a
billing account” and set the billing account to “My billing
account”.</p>
<p><img src="storage3.PNG" width="50%"></p>
<p>All this is necessary for you to be able to access Google Storage and
other Google tools programmatically. Both Google Storage and DAI are
paid services, although for Google Storage the cost is negligible unless
you plan to keep very large amounts of data there for a long time. For
DAI, you’re looking at around EUR 0.06 per processed page, though at the
current time of writing, you get 300$ worth of free credits.</p>
</div>
<div class="section level3">
<h3 id="step-4-set-up-a-service-account">Step 4: Set up a service account<a class="anchor" aria-label="anchor" href="#step-4-set-up-a-service-account"></a>
</h3>
<p>Now we need to create a service account. Bring out the navigation
menu on the left hand side by clicking the little circle with the three
horizontal lines in the top left of the screen. Click on “APIs and
services.” Then click on “credentials” in the left pane. You should see
this:</p>
<p><img src="storage4.PNG" width="50%"></p>
<p>Click on “create credentials” in the top middle, then choose service
account. Give it any name you like (e.g. “my_rstudio_service_account”)
and a description (e.g. “Interacting with GCS through R”) and click
“create”.</p>
<p>In section 2 titled “Grant this service account access to project”,
add “Basic &gt; <strong>Owner</strong>” to the service account’s
roles.</p>
<p><img src="storage5.PNG" width="50%"></p>
<p>Click “continue”, then “done” at the bottom. You should now see your
service account listed at the bottom.</p>
<p><img src="storage6.PNG" width="50%"></p>
</div>
<div class="section level3">
<h3 id="step-5-download-a-json-file-with-the-service-account-key">Step 5: Download a json file with the service account key<a class="anchor" aria-label="anchor" href="#step-5-download-a-json-file-with-the-service-account-key"></a>
</h3>
<p>Now we need to generate a json file containing the login details for
this service account. Click the small edit icon on the bottom right. On
the next page, click “add key”, choose “create new key”, select JSON
format, and click “create”. This should prompt a save file window. Save
the file to your hard drive. You can change the name to something more
memorable if you like (but keep the “.json” extension). Also, take note
of where you stored it. Now we are done in the Google Cloud Console and
can finally start working in RStudio.</p>
</div>
<div class="section level3">
<h3 id="step-6-tell-rstudio-where-to-find-the-json-file">Step 6: Tell RStudio where to find the json file<a class="anchor" aria-label="anchor" href="#step-6-tell-rstudio-where-to-find-the-json-file"></a>
</h3>
<p>The last step is to store the path to the json file in your .Renviron
file so that RStudio can authenticate you whenever you are working with
GCS from R. Start by writing the following in the console:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_environ</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will open a pane with your .Renviron file. If you haven’t
modified it before, it is probably empty.</p>
<p>All you need to do is add a line with the following:
<strong><code>GCS_AUTH_FILE='&lt;full path to the json file you stored earlier&gt;'</code></strong>.
Make sure all the slashes in the filepath are forward slashes. Save the
file, close it, and restart RStudio.</p>
<p>Now when you load the library <code>googleCloudStorageR</code>, you
will be auto-authenticated and ready to communicate with your Google
Storage account from within R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://code.markedmondson.me/googleCloudStorageR/" class="external-link">googleCloudStorageR</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-googlecloudstorager">Working with googleCloudStorageR<a class="anchor" aria-label="anchor" href="#working-with-googlecloudstorager"></a>
</h2>
<p><code>googleCloudStorageR</code> is a so-called wrapper for the
Google Storage API, which means it translates your R input into URLs
that the API can understand. When you execute
<code>googleCloudStorageR</code> functions, you are really sending GET
and POST requests to Google and receiving responses in return.</p>
<div class="section level3">
<h3 id="creating-and-inspecting-buckets">Creating and inspecting buckets<a class="anchor" aria-label="anchor" href="#creating-and-inspecting-buckets"></a>
</h3>
<p>Google Storage is a file repository, and it keeps your files in
so-called “buckets”. You need at least one bucket to store files. To
inspect your Storage account, first bring out your project id. If you
did not store it in step 3 above, you can look it up in the Google Cloud
Console or use the <code>daiR</code> function
<code><a href="../reference/get_project_id.html">get_project_id()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project_id</span> <span class="op">&lt;-</span> <span class="fu">daiR</span><span class="fu">::</span><span class="fu"><a href="../reference/get_project_id.html">get_project_id</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s see how many buckets we have:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_buckets.html" class="external-link">gcs_list_buckets</a></span><span class="op">(</span><span class="va">project_id</span><span class="op">)</span></span></code></pre></div>
<p>Answer: zero, because we haven’t created one yet. We can do this with
<code><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_create_bucket.html" class="external-link">gcs_create_bucket()</a></code>. Note that it has to be globally unique
(“my_bucket” won’t work because someone’s already taken it). For this
example, let’s use “dair-example-bucket”. Also add a location (“EU” or
“US”).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_create_bucket.html" class="external-link">gcs_create_bucket</a></span><span class="op">(</span><span class="st">"dair-example-bucket"</span>, <span class="va">project_id</span>, location <span class="op">=</span> <span class="st">"EU"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can see the bucket listed:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_buckets.html" class="external-link">gcs_list_buckets</a></span><span class="op">(</span><span class="va">project_id</span><span class="op">)</span></span></code></pre></div>
<p>You will need to supply a bucket name with every call to Google
Storage (and Document AI), so you may want to store the name of a
default bucket in the environment. You have two options:</p>
<ol style="list-style-type: decimal">
<li><p>Store it permanently in you .Renviron file by calling
<code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code> and adding
<code>GCS_DEFAULT_BUCKET=&lt;your bucket name&gt;</code> to the list of
variables, just as you did with the json key file path
(<code>GCS_AUTH_FILE</code>) earlier. Note that adding a default bucket
to .Renviron will not prevent you from supplying other bucket names in
individual calls to Google Storage when necessary.</p></li>
<li><p>Set it for the current session with
<code>gcs_global_bucket("&lt;your bucket name&gt;")</code></p></li>
</ol>
<p>To get a bucket’s file inventory, we use
<code><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_objects.html" class="external-link">gcs_list_objects()</a></code>. Leaving the parentheses empty will get
information about the default bucket if you have set it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_objects.html" class="external-link">gcs_list_objects</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At this point it’s obviously empty, so let’s upload something.</p>
</div>
<div class="section level3">
<h3 id="uploading-files">Uploading files<a class="anchor" aria-label="anchor" href="#uploading-files"></a>
</h3>
<p>This we do with <code><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_upload.html" class="external-link">gcs_upload()</a></code>. If the file is in your
working directory, just write the filename; otherwise provide the full
file path. If you want, you can store the file under another name in
Google Storage with the <code>name</code> parameter. Otherwise, just
leave the parameter out.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="st">"mtcars.csv"</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_upload.html" class="external-link">gcs_upload</a></span><span class="op">(</span><span class="st">"mtcars.csv"</span><span class="op">)</span></span></code></pre></div>
<p><code>resp</code> here is just a container for the response that the
API returns, to prevent it from printing in the console.</p>
<p>Now let’s check the contents:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_objects.html" class="external-link">gcs_list_objects</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">contents</span></span></code></pre></div>
<p>The Google Storage API handles only one file at a time, so for bulk
uploads you need to use iteration.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">iris</span>, <span class="st">"iris.csv"</span><span class="op">)</span></span>
<span><span class="va">my_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html" class="external-link">dir_ls</a></span><span class="op">(</span>glob <span class="op">=</span> <span class="st">"*.csv"</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">my_files</span>, <span class="op">~</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_upload.html" class="external-link">gcs_upload</a></span><span class="op">(</span><span class="va">.x</span>, name <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check the contents again:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_objects.html" class="external-link">gcs_list_objects</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">contents</span></span></code></pre></div>
<p>Note that there’s a file size limit of 5Mb, but you can change it
with <code><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_upload.html" class="external-link">gcs_upload_set_limit()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_upload.html" class="external-link">gcs_upload_set_limit</a></span><span class="op">(</span>upload_limit <span class="op">=</span> <span class="fl">20000000L</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downloading-files">Downloading files<a class="anchor" aria-label="anchor" href="#downloading-files"></a>
</h3>
<p>Downloads are performed with gcs_get_object(). Here, too, you can
save it under a different name, but this time the parameter is
<code>saveToDisk</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_get_object.html" class="external-link">gcs_get_object</a></span><span class="op">(</span><span class="st">"mtcars.csv"</span>, saveToDisk <span class="op">=</span> <span class="st">"mtcars_duplicate.csv"</span><span class="op">)</span></span></code></pre></div>
<p>To download multiple files we need to loop or map. Let’s say we
wanted to download all the files in the bucket:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_objects.html" class="external-link">gcs_list_objects</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">contents</span><span class="op">$</span><span class="va">name</span>, <span class="op">~</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_get_object.html" class="external-link">gcs_get_object</a></span><span class="op">(</span><span class="va">.x</span>, saveToDisk <span class="op">=</span> <span class="va">.x</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="deleting">Deleting<a class="anchor" aria-label="anchor" href="#deleting"></a>
</h3>
<p>We can delete files in the bucket with
<code><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_delete_object.html" class="external-link">gcs_delete_object()</a></code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_delete_object.html" class="external-link">gcs_delete_object</a></span><span class="op">(</span><span class="st">"mtcars.csv"</span><span class="op">)</span></span></code></pre></div>
<p>To delete several, we again need to loop or map. Let’s try to delete
everything in the bucket:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cloudyr.github.io/googleCloudStorageR//reference/gcs_list_objects.html" class="external-link">gcs_list_objects</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">contents</span><span class="op">$</span><span class="va">name</span>, <span class="va">gcs_delete_object</span><span class="op">)</span></span></code></pre></div>
<p>And the bucket is empty. With this you should be ready to process
files with Document AI and other APIs that involve Google Storage as an
intermediary.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Hegghammer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
