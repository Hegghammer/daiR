<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configuration • daiR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Configuration">
<meta property="og:description" content="daiR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-NL6TR4PT51"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NL6TR4PT51');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">daiR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/quickstart.html">Quickstart</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/configuration.html">Configuration</a>
    </li>
    <li>
      <a href="../articles/gcs_storage.html">Working with Google Cloud Storage</a>
    </li>
    <li>
      <a href="../articles/usage.html">Basic usage</a>
    </li>
    <li>
      <a href="../articles/tables.html">Extracting tables</a>
    </li>
    <li>
      <a href="../articles/reconstructing_text.html">Correcting text output</a>
    </li>
    <li>
      <a href="../articles/searchable_pdfs.html">Creating searchable PDFs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/faqs.html">FAQs</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/hegghammer/dair/" class="external-link">
    <span class="fab fa-github"></span>
     
    Github
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Hegghammer/daiR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Configuration</h1>
                        <h4 data-toc-skip class="author">Thomas
Hegghammer</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Hegghammer/daiR/blob/HEAD/vignettes/configuration.Rmd" class="external-link"><code>vignettes/configuration.Rmd</code></a></small>
      <div class="hidden name"><code>configuration.Rmd</code></div>

    </div>

    
    
<p><em>Last updated 10 February 2024</em><br><br></p>
<p><strong>Command line users: See <a href="https://dair.info/articles/gcs_cli.html" class="external-link">here</a> for GCS setup
using gcloud CLI.</strong><br><br></p>
<p>This is a rundown for beginners of how to set up a Google Cloud
Services account so you can start using Google Document AI.</p>
<div class="section level2">
<h2 id="authentication">Authentication<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h2>
<p>The biggest hurdle to using any Google API is authentication. It can
be daunting, partly because it involves abstract new concepts like
“service accounts”, “Oauth2.0”, and “scopes”, and partly because the
website you have to work with – the <a href="https://console.cloud.google.com/" class="external-link">Google Cloud Console</a> – is a
nightmare to navigate.</p>
<p>There are several different ways to authenticate to GCS from R, and
you may have seen that different R packages do it slightly differently
(see e.g. <a href="https://gmailr.r-lib.org/" class="external-link">gmailr</a> and <a href="https://bigrquery.r-dbi.org/" class="external-link">bigrquery</a>). This vignette takes
an opinionated approach and recommends using service accounts and json
key files. It involves a little bit more hands-on configuration than
some of the setup wizards in other R packages, but my thinking is that
if you are computer-literate enough to consider using an API, you are
probably also able to navigate the GCS and set environmental variables
in R. But know that there are <a href="https://cran.r-project.org/package=gargle/vignettes/get-api-credentials.html" class="external-link">several</a>
<a href="https://cran.r-project.org/package=googleAuthR/vignettes/google-authentication-types.html" class="external-link">other</a>
authentication strategies, and you can use <code>daiR</code> with most
of them so long as you obtain an authentication token.</p>
<p>There are nine main steps to go through before you can start using
<code>daiR</code>.</p>
<div class="section level3">
<h3 id="step-1-get-a-gmail-account">Step 1: Get a Gmail account<a class="anchor" aria-label="anchor" href="#step-1-get-a-gmail-account"></a>
</h3>
<p>If you have one already, you can use that. Or you can <a href="https://accounts.google.com/signup/v2/webcreateaccount" class="external-link">create</a>
a burner account for your GCS work.</p>
</div>
<div class="section level3">
<h3 id="step-2-activate-the-google-cloud-console">Step 2: Activate the Google Cloud Console<a class="anchor" aria-label="anchor" href="#step-2-activate-the-google-cloud-console"></a>
</h3>
<p>While logged in to your gmail account, go to the <a href="https://console.cloud.google.com/" class="external-link">Google Cloud Console</a>. Agree
to the terms of service and click “Try for free”.</p>
<p><img src="storage1.PNG" width="50%"></p>
<p>Accept the terms again, and add an address and a <strong>credit
card</strong>. This last part is a prerequisite for using GCS. But
Google Document AI is not particularly expensive to use; see the <a href="https://dair.info/articles/faqs.html#how-much-does-google-document-ai-cost-to-use" class="external-link">FAQ
page</a> for updated prices.</p>
</div>
<div class="section level3">
<h3 id="step-3-link-your-project-to-your-billing-account">Step 3: Link your project to your billing account<a class="anchor" aria-label="anchor" href="#step-3-link-your-project-to-your-billing-account"></a>
</h3>
<p>The largest “unit” of your GCS activities is your <em>project</em>.
You can think of it as your root folder, since you will most likely only
ever need one unless you are a business or a developer (though in
principle you can have as many projects as you like).</p>
<p>When you activate GCS, you are assigned a project named “My first
project”. Click on “My first project” in the top blue bar, just to the
right of “Google cloud services”. You’ll see a screen like this:</p>
<p><img src="storage2.PNG" width="50%"></p>
<p>Note that your project has an <em>ID</em>, usually consisting of an
adjective, a noun, and a number. You’ll need this soon, so I recommend
opening RStudio and storing it as a vector with
<code>project_id &lt;- "&lt;your project id&gt;"</code>.</p>
<p>Return to the Google Cloud Console and look at the left column.
Toward the top you see an entry called “Billing”. Click it. You’ll get
to a screen saying “This project has no billing account”. Click “link a
billing account” and set the billing account to “My billing
account”.</p>
<p><img src="storage3.PNG" width="50%"></p>
<p>All this is necessary for you to be able to use Google Document AI
(DAI) and related services programmatically.</p>
</div>
<div class="section level3">
<h3 id="step-4-set-up-a-service-account">Step 4: Set up a service account<a class="anchor" aria-label="anchor" href="#step-4-set-up-a-service-account"></a>
</h3>
<p>Now we need to create a service account. Bring out the navigation
menu on the left hand side by clicking the little circle with the three
horizontal lines in the top left of the screen. Click on “APIs and
services.” Then click on “credentials” in the left pane. You should see
this:</p>
<p><img src="storage4.PNG" width="50%"></p>
<p>Click on “create credentials” in the top middle, then choose service
account. Give it any name you like (e.g. “my_rstudio_service_account”)
and a description (e.g. “Interacting with GCS through R”) and click
“create”.</p>
<p>In section 2 titled “Grant this service account access to project”,
add “Basic &gt; <strong>Owner</strong>” to the service account’s
roles.</p>
<p><img src="storage5.PNG" width="50%"></p>
<p>Click “continue”, then “done” at the bottom. You should now see your
service account listed at the bottom.</p>
<p><img src="storage6.PNG" width="50%"></p>
</div>
<div class="section level3">
<h3 id="step-5-download-a-json-file-with-the-service-account-key">Step 5: Download a json file with the service account key<a class="anchor" aria-label="anchor" href="#step-5-download-a-json-file-with-the-service-account-key"></a>
</h3>
<p>Now we need to generate a JSON file containing the credentials for
this service account. Click the small edit icon on the bottom right. On
the next page, click “add key”, choose “create new key”, select JSON
format, and click “create”. This should prompt a save file window. Save
the file to your hard drive. You can change the name to something more
memorable if you like (but keep the <code>.json</code> extension). Also,
take note of where you stored it. Now we are done in the Google Cloud
Console and can finally start working in RStudio.</p>
</div>
<div class="section level3">
<h3 id="step-6-store-the-path-to-the-credentials-file-as-an-environmental-variable">Step 6: Store the path to the credentials file as an environmental
variable<a class="anchor" aria-label="anchor" href="#step-6-store-the-path-to-the-credentials-file-as-an-environmental-variable"></a>
</h3>
<p>You want <code>daiR</code> to automatically authenticate you when you
load the package so you don’t have to fiddle with authentication every
time. For this to happen, you need to tell R where it can find the JSON
file with the credentials. We do this by storing the path to the json
file as an environmental variable in your <code>.Renviron</code> file.
Start by writing the following in your RStudio console:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_environ</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will open a pane with your <code>.Renviron</code> file. If you
haven’t modified it before, it is probably empty.</p>
<p>All you need to do is add a line with the following:
<strong><code>GCS_AUTH_FILE='&lt;full path to the json file you stored earlier&gt;'</code></strong>.
Make sure all the slashes in the filepath are forward slashes. It should
look something like this:</p>
<pre><code><span><span class="va">GCS_AUTH_FILE</span><span class="op">=</span><span class="st">'path/to/gcs-service-account-file.json'</span></span></code></pre>
<p>Save the file, close it, and restart RStudio. If you try to load
<code>daiR</code> now with <code><a href="https://github.com/Hegghammer/daiR" class="external-link">library(daiR)</a></code>, you will be
auto-authenticated, but there are a few more steps left before you can
start processing.</p>
</div>
<div class="section level3">
<h3 id="step-7-activate-document-ai">Step 7: Activate Document AI<a class="anchor" aria-label="anchor" href="#step-7-activate-document-ai"></a>
</h3>
<p>Head back to your browser and the <a href="https://console.cloud.google.com/" class="external-link">GCS website</a>. We now need to
activate the Google Document AI API for your account. Open the
navigation menu on the left hand side. Click on “APIs and services”.
Then click on “Enable APIs and Services”, type “document ai” in the
search field, click on “Cloud Document AI API”, and then “Enable”.</p>
</div>
<div class="section level3">
<h3 id="step-8-create-a-processor">Step 8: Create a processor<a class="anchor" aria-label="anchor" href="#step-8-create-a-processor"></a>
</h3>
<p>In order to process documents, you also need to set up an OCR
processor. This is easiest done inside R using the function
<code><a href="../reference/create_processor.html">daiR::create_processor</a></code>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> We start by loading the <code>daiR</code>
package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Hegghammer/daiR" class="external-link">daiR</a></span><span class="op">)</span></span></code></pre></div>
<p>You now need to think of a globally unique display name for the
processor, to be supplied with the <code><a href="../reference/create_processor.html">create_processor()</a></code>
function. Processor names are shared across the GCS ecosystem, so simple
ones like “processor” or “my-processor” are probably already taken.
Instead try something along the lines of “ocr-general-9567”.</p>
<p>If successful, the <code><a href="../reference/create_processor.html">create_processor()</a></code> function will
return a processor id, a 16-character sequence of random numbers and
letters. Take good note of it, for while the name (“ocr-general-9567”)
is just a display name to help you distinguish between processors when
you have several, the id is what really identifies it to the Document AI
API.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## NOT RUN</span></span>
<span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_processor.html">create_processor</a></span><span class="op">(</span><span class="st">"&lt;my-unique-processor-name&gt;"</span><span class="op">)</span></span></code></pre></div>
<p>It is possible to create more than one processor, but most users only
need one at any given time. To view your processors, run
<code><a href="../reference/get_processors.html">daiR::get_processors()</a></code>. Should you wish to delete one, use
<code><a href="../reference/delete_processor.html">daiR::delete_processor()</a></code>.</p>
<p>There are several <a href="https://dair.info/articles/faqs.html#how-many-different-processors-are-there" class="external-link">different
types</a> of processors available, but most users will want the generic
one (called <code>OCR_PROCESSOR</code>), and this is what
<code><a href="../reference/create_processor.html">daiR::create_processor()</a></code> defaults to. The other main type
to note is <code>FORM_PARSER_PROCESSOR</code>, which can identify
tables.</p>
<p>Processor types also come in different <em>versions</em>, with each
version representing a snapshot of the underlying machine learning
model. There will typically be a couple of stable versions and a more
recent, pre-release version of any one processor type. The difference in
performance between versions is rarely substantial, so you do not need
to worry about specifying a processor version at this stage.</p>
</div>
<div class="section level3">
<h3 id="step-9-store-the-processor-id-as-an-environment-variable">Step 9: Store the processor id as an environment variable<a class="anchor" aria-label="anchor" href="#step-9-store-the-processor-id-as-an-environment-variable"></a>
</h3>
<p>Every Document AI processing request needs to contain a processor id,
so I strongly recommend storing the id you just generated in an
environment variable called <code>DAI_PROCESSOR_ID</code>. All of
<code>daiR</code>’s processing functions are set up to look for this
variable.</p>
<p>Open your <code>.Renviron</code> file by calling
<code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code>. Add
<code>DAI_PROCESSOR_ID="&lt;your processor id&gt;"</code> on a separate
line. Your <code>.Renviron</code> may now look something like this:</p>
<pre><code><span><span class="va">GCS_AUTH_FILE</span><span class="op">=</span><span class="st">'path/to/gcs-service-account-file.json'</span></span>
<span><span class="va">DAI_PROCESSOR_ID</span><span class="op">=</span><span class="st">'1234567890abcdef'</span></span></code></pre>
<p>Save <code>.Renviron</code> and restart RStudio. That’s it: You’re
now ready to <a href="https://dair.info/articles/gcs_cli.html" class="external-link">start
processing</a>. Note that in order to process asynchronously (best for
large batches), you will need to familiarise yourself with Google Cloud
Storage as well, so you may want to look at the <a href="https://dair.info/articles/gcs_storage.html" class="external-link">vignette on Google
Cloud Storage</a> right away.</p>
</div>
<div class="section level3">
<h3 id="cheatsheet">Cheatsheet<a class="anchor" aria-label="anchor" href="#cheatsheet"></a>
</h3>
<p>If you ever get lost in the jungle of GCS terms, check out the <a href="https://dair.info/articles/cheatsheet.html" class="external-link">concept
cheatsheet</a>.</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>It is also possible to create processors manually in the
Google Cloud Console.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Hegghammer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
